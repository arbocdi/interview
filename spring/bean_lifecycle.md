# –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –±–∏–Ω–∞ –≤ Spring

## –°–≤–æ–¥–Ω–∞—è —Å—Ö–µ–º–∞
```java
ApplicationContext: creates BeanDefinition
   ‚Üì
BeanFactoryPostProcessor: modifies BeanDefinition
   ‚Üì
Bean Instantiation: constructor call
   ‚Üì
Dependency injection:
   ‚Üì
Aware interfaces:
   ‚Üì
BeanPostProcessor:postProcessBeforeInit
   ‚Üì
@PostConstruct / afterPropertiesSet
   ‚Üì
BeanPostProcessor:postProcessAfterInit (AOP proxy)
   ‚Üì
READY
   ‚Üì
@PreDestroy / destroy
```
---
## 0. –°—Ç–∞—Ä—Ç ApplicationContext
Spring –ø–æ–¥–Ω–∏–º–∞–µ—Ç `ApplicationContext` –∏:
- —á–∏—Ç–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (`@Configuration`, `@ComponentScan`, XML)
- **—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç BeanDefinition** (–æ–ø–∏—Å–∞–Ω–∏—è –±–∏–Ω–æ–≤)

üìå **–ë–∏–Ω–æ–≤ –µ—â—ë –Ω–µ—Ç**, –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ:
- –∫–ª–∞—Å—Å
- scope
- –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- init / destroy –º–µ—Ç–æ–¥—ã

---

## 1. BeanFactoryPostProcessor / BeanDefinitionRegistryPostProcessor
–í—ã–∑—ã–≤–∞—é—Ç—Å—è **–¥–æ —Å–æ–∑–¥–∞–Ω–∏—è –ª—é–±—ã—Ö –±–∏–Ω–æ–≤**.

–ú–æ–≥—É—Ç:
- –∏–∑–º–µ–Ω—è—Ç—å `BeanDefinition`
- –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –±–∏–Ω—ã
- –º–µ–Ω—è—Ç—å scope, –∫–ª–∞—Å—Å—ã, —Å–≤–æ–π—Å—Ç–≤–∞

üìå –†–∞–±–æ—Ç–∞—é—Ç **—Å –æ–ø–∏—Å–∞–Ω–∏—è–º–∏**, –∞ –Ω–µ —Å –æ–±—ä–µ–∫—Ç–∞–º–∏.

---

## 2. –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Å—Ç–∞–Ω—Å–∞ –±–∏–Ω–∞ (Instantiation)
Spring —Ä–µ—à–∞–µ—Ç, —á—Ç–æ –±–∏–Ω –Ω—É–∂–µ–Ω, –∏:
- –≤—ã–±–∏—Ä–∞–µ—Ç –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
- –≤—ã–∑—ã–≤–∞–µ—Ç `new Bean(...)`

üìå –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ **–µ—â—ë –Ω–µ –≤–Ω–µ–¥—Ä–µ–Ω—ã**.

---

## 3. Dependency Injection (Populate Properties)
Spring –≤–Ω–µ–¥—Ä—è–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
- `@Autowired`
- `@Qualifier`
- `@Value`
- —Å–µ—Ç—Ç–µ—Ä—ã

üìå –ë–∏–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –µ—â—ë **—Å—ã—Ä–æ–π**.

---

## 4. Aware-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
–ï—Å–ª–∏ –±–∏–Ω —Ä–µ–∞–ª–∏–∑—É–µ—Ç:
- `BeanNameAware`
- `BeanClassLoaderAware`
- `BeanFactoryAware`
- `ApplicationContextAware`

Spring –≤—ã–∑—ã–≤–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã:
```java
setBeanName(...)
setApplicationContext(...)
```

üìå –ë–∏–Ω —É–∑–Ω–∞—ë—Ç —Å–≤–æ—ë –æ–∫—Ä—É–∂–µ–Ω–∏–µ.

---

## 5. BeanPostProcessor ‚Äî BEFORE initialization
–í—ã–∑—ã–≤–∞—é—Ç—Å—è –≤—Å–µ `BeanPostProcessor`:
```java
postProcessBeforeInitialization(bean, name)
```

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:
- –¥–æ–ø. –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—é

---

## 6. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∏–Ω–∞
–í—ã–∑—ã–≤–∞–µ—Ç—Å—è **–æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤** (–ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É):

1. `@PostConstruct`
2. `InitializingBean.afterPropertiesSet()`
3. `initMethod` —É `@Bean`

üìå –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É–∂–µ –≤–Ω–µ–¥—Ä–µ–Ω—ã.

---

## 7. BeanPostProcessor ‚Äî AFTER initialization
```java
postProcessAfterInitialization(bean, name)
```

üî• **–ó–¥–µ—Å—å –æ–±—ã—á–Ω–æ —Å–æ–∑–¥–∞—é—Ç—Å—è AOP-–ø—Ä–æ–∫—Å–∏**:
- `@Transactional`
- `@Async`
- `@Cacheable`
- `@Retryable`

üìå –ë–∏–Ω, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã –ø–æ–ª—É—á–∞–µ—à—å –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –º–æ–∂–µ—Ç –±—ã—Ç—å **–ø—Ä–æ–∫—Å–∏**, –∞ –Ω–µ –∏—Å—Ö–æ–¥–Ω—ã–π –æ–±—ä–µ–∫—Ç.

---

## 8. –ë–∏–Ω –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ singleton cache
- —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ AOP, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö, —Å–æ–±—ã—Ç–∏—è—Ö

---

## 9. Runtime
–ë–∏–Ω:
- –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
- –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω
- —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –∂–∏–∑–Ω–µ–Ω–Ω–æ–º —Ü–∏–∫–ª–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

---

## 10. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (Shutdown)
–ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ `ApplicationContext`:

1. `@PreDestroy`
2. `DisposableBean.destroy()`
3. `destroyMethod` —É `@Bean`

üìå –í—ã–∑—ã–≤–∞–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –¥–ª—è singleton-–±–∏–Ω–æ–≤**.

---
## –í–∞–∂–Ω—ã–µ –Ω—é–∞–Ω—Å—ã

### –ü–æ—á–µ–º—É `@Transactional` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ `@PostConstruct`
–ü—Ä–æ–∫—Å–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è **–ø–æ—Å–ª–µ init-—Ñ–∞–∑—ã**, –ø–æ—ç—Ç–æ–º—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –µ—â—ë –Ω–µ—Ç.

### –ü–æ—á–µ–º—É self-invocation –ª–æ–º–∞–µ—Ç AOP
–í—ã–∑–æ–≤ –∏–¥—ë—Ç **–º–∏–º–æ –ø—Ä–æ–∫—Å–∏**, –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ `this`.

### Prototype scope
- —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º `getBean`
- destroy-–º–µ—Ç–æ–¥—ã **–Ω–µ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---
## –°–æ–∑–¥–∞—é—Ç—Å—è –ª–∏ singleton-–±–∏–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ Spring?

**–ö–æ—Ä–æ—Ç–∫–æ: –¥–∞, –Ω–æ —Å –Ω—é–∞–Ω—Å–∞–º–∏.**

---

## –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

–í Spring:

* **scope –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî `singleton`**
* —Ç–∞–∫–∏–µ –±–∏–Ω—ã **—Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ `ApplicationContext`**

–≠—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **eager initialization**.

```java
@Component
class MyService { }
```

‚û°Ô∏è `MyService` –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω **–ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**, –¥–∞–∂–µ –µ—Å–ª–∏:

* –Ω–∞ –Ω–µ–≥–æ –Ω–∏–∫—Ç–æ –Ω–µ —Å—Å—ã–ª–∞–µ—Ç—Å—è
* –µ–≥–æ –Ω–∏–∫—Ç–æ —è–≤–Ω–æ –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª

---

## –ö–æ–≥–¥–∞ –∏–º–µ–Ω–Ω–æ —Å–æ–∑–¥–∞—é—Ç—Å—è singleton-–±–∏–Ω—ã

–í–æ –≤—Ä–µ–º—è:

refresh() ‚Äî —ç—Ç–æ –ø–æ–ª–Ω—ã–π lifecycle-–∫—Ä—É–≥ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:

–£–ø—Ä–æ—â—ë–Ω–Ω–æ:
```
destroy singletons
‚Üì
clear caches
‚Üì
re-register BeanDefinitions
‚Üì
create all singleton beans (eager)
```

–¢–æ –µ—Å—Ç—å:
- —Å—Ç–∞—Ä—ã–µ singleton-–±–∏–Ω—ã —É–Ω–∏—á—Ç–æ–∂–∞—é—Ç—Å—è
- –∏—Ö @PreDestroy / destroy() –≤—ã–∑—ã–≤–∞—é—Ç—Å—è
- –∑–∞—Ç–µ–º —Å–æ–∑–¥–∞—é—Ç—Å—è –ù–û–í–´–ï —ç–∫–∑–µ–º–ø–ª—è—Ä—ã

Spring:

1. —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç `BeanDefinition`
2. **—Å–æ–∑–¥–∞—ë—Ç –≤—Å–µ singleton-–±–∏–Ω—ã**
3. –∫–ª–∞–¥—ë—Ç –∏—Ö –≤ singleton cache

---

## –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: `@Lazy`

```java
@Component
@Lazy
class MyService { }
```

‚û°Ô∏è –±–∏–Ω:

* **–ù–ï —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ**
* —Å–æ–∑–¥–∞—ë—Ç—Å—è **–ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏**

```java
@Autowired
MyService service; // ‚Üê –≤–æ—Ç —Ç—É—Ç
```

---

## Prototype ‚Äî –Ω–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

```java
@Component
@Scope("prototype")
class MyProto { }
```

* ‚ùå –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
* ‚úÖ —Å–æ–∑–¥–∞—ë—Ç—Å—è **—Ç–æ–ª—å–∫–æ –ø—Ä–∏ `getBean()`**

## Scoped (request, session)

- –°–æ–∑–¥–∞—é—Ç—Å—è **–ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ –≤ —Ä–∞–º–∫–∞—Ö –∞–∫—Ç–∏–≤–Ω–æ–≥–æ scope**  
  (–∞ –Ω–µ –≤ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Å–∞–º–æ–≥–æ scope)

- `@PreDestroy` –∏ –¥—Ä—É–≥–∏–µ destroy-–º–µ—Ç–æ–¥—ã –≤—ã–∑—ã–≤–∞—é—Ç—Å—è  
  **–ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ scope**
    - `request` ‚Üí –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ HTTP-–∑–∞–ø—Ä–æ—Å–∞
    - `session` ‚Üí –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ HTTP-—Å–µ—Å—Å–∏–∏


---

## –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏

| Scope               | –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ  |
| ------------------- | -------------------- |
| `singleton`         | ‚úÖ –¥–∞                 |
| `singleton @Lazy`   | ‚ùå –Ω–µ—Ç                |
| `prototype`         | ‚ùå –Ω–µ—Ç                |
| `request / session` | ‚ùå –Ω–µ—Ç (—á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏) |

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –Ω—é–∞–Ω—Å

Singleton —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ **—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –±–∏–Ω —Ä–µ–∞–ª—å–Ω–æ –∞–∫—Ç–∏–≤–µ–Ω**:

* –Ω–µ `abstract`
* —É—Å–ª–æ–≤–∏–µ `@Conditional...` –≤—ã–ø–æ–ª–Ω–µ–Ω–æ

```java
@ConditionalOnProperty(name = "feature.x", havingValue = "true")
```

–ï—Å–ª–∏ —É—Å–ª–æ–≤–∏–µ –ª–æ–∂–Ω–æ ‚Äî –±–∏–Ω **–Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤–æ–æ–±—â–µ**.

---

## –ò—Ç–æ–≥

* ‚úÖ `singleton` ‚Äî scope –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
* ‚úÖ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
* ‚ùå –∫—Ä–æ–º–µ `@Lazy`
* ‚ùå `prototype` –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞—Ä–∞–Ω–µ–µ
* üß† Spring –∏—Å–ø–æ–ª—å–∑—É–µ—Ç eager-init –∫–∞–∫ fail-fast —Å—Ç—Ä–∞—Ç–µ–≥–∏—é

---

### –û–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ –¥–ª—è –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è

> **Singleton-–±–∏–Ω –≤ Spring —Å–æ–∑–¥–∞—ë—Ç—Å—è eagerly –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –µ—Å–ª–∏ –Ω–µ –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ `@Lazy`.**

